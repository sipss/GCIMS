<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to GCIMS • GCIMS</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to GCIMS">
<meta property="og:description" content="GCIMS">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">GCIMS</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/creating-a-workflow-step.html">Creating a workflow step</a>
    </li>
    <li>
      <a href="../articles/introduction-to-gcims.html">Introduction to GCIMS</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Introduction to GCIMS</h1>
                        <h4 data-toc-skip class="author">GCIMS
authors</h4>
            
            <h4 data-toc-skip class="date">2023-02-21</h4>
      
      
      <div class="hidden name"><code>introduction-to-gcims.Rmd</code></div>

    </div>

    
        <div class="abstract">
      <p class="abstract">Abstract</p>
      <p>An introduction to the GCIMS package, showing the most relevant
      functions and a proposed workflow. This includes loading demo
      samples, adding sample annotations, preprocessing the spectra,
      alignment, detecting peaks and regions of interest (ROIs),
      clustering of ROIs across samples, peak integration and building a
      peak table.</p>
    </div>
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">start_time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/Bioconductor/BiocParallel" class="external-link">BiocParallel</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">GCIMS</span><span class="op">)</span></span></code></pre></div>
<p>The GCIMS package allows you to import your Gas Chromatography - Ion
Mobility Spectrometry samples, preprocess them, align them one to each
other and build a peak table with the relevant features.</p>
<p>Enable parallellization of the workflow, here we use three cores:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">show_progress_bar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/interactive.html" class="external-link">interactive</a></span><span class="op">(</span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"knitr.in.progress"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># disable parallellization: (Useful for better error reporting)</span></span>
<span><span class="co">#register(SerialParam(progressbar = show_progress_bar), default = TRUE)</span></span>
<span><span class="co"># enable parallellization with 3 workers (you can use more if you have them):</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/register.html" class="external-link">register</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/SerialParam-class.html" class="external-link">SerialParam</a></span><span class="op">(</span><span class="op">)</span>, default <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/register.html" class="external-link">register</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/SnowParam-class.html" class="external-link">SnowParam</a></span><span class="op">(</span>workers <span class="op">=</span> <span class="fl">3</span>, progressbar <span class="op">=</span> <span class="va">show_progress_bar</span>, exportglobals <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>, default <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>This vignette will use a small dataset consisting of a mixture of
three ketones.</p>
<div class="section level2">
<h2 id="downloading-the-dataset">Downloading the dataset<a class="anchor" aria-label="anchor" href="#downloading-the-dataset"></a>
</h2>
<p>Download the “threeketones” dataset:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># The folder where we will download the samples:</span></span>
<span><span class="va">samples_directory</span> <span class="op">&lt;-</span> <span class="st">"threeketones"</span></span>
<span></span>
<span><span class="co"># Download the ketones dataset:</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/download_three_ketones_dataset.html">download_three_ketones_dataset</a></span><span class="op">(</span><span class="va">samples_directory</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Download successful"</span><span class="op">)</span></span>
<span><span class="op">}</span>, error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"The download of the samples did not succeed. The vignette can't continue."</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">conditionMessage</a></span><span class="op">(</span><span class="va">e</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/knit_exit.html" class="external-link">knit_exit</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">#&gt; Download successful</span></span></code></pre></div>
<p>Check that the files are downloaded:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">samples_directory</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "211105_095453.mea.gz" "211105_135744.mea.gz" "211108_141524.mea.gz"</span></span>
<span><span class="co">#&gt; [4] "annotations.csv"      "README.txt"</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="import-data">Import data<a class="anchor" aria-label="anchor" href="#import-data"></a>
</h2>
<p>Please start by preparing an Excel spreadsheet (or a CSV/TSV file if
you prefer) with your samples and their annotations. Please name the
first column <code>SampleID</code> and the second column
<code>Filename</code>. We will use those annotations in plots.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">annotations</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">samples_directory</span>, <span class="st">"annotations.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">annotations</span></span>
<span><span class="co">#&gt;   SampleID             Filename Analyst</span></span>
<span><span class="co">#&gt; 1 Ketones1 211105_095453.mea.gz   Celia</span></span>
<span><span class="co">#&gt; 2 Ketones2 211105_135744.mea.gz   Meryl</span></span>
<span><span class="co">#&gt; 3 Ketones3 211108_141524.mea.gz   Celia</span></span></code></pre></div>
<p>If you need to create your <code>annotations.csv</code> file for your
samples, please follow the example from
<code><a href="../reference/create_annotations_table.html">help("create_annotations_table")</a></code> for further details.</p>
</div>
<div class="section level2">
<h2 id="create-a-gcimsdataset-object">Create a GCIMSDataset object<a class="anchor" aria-label="anchor" href="#create-a-gcimsdataset-object"></a>
</h2>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dataset</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GCIMSDataset-class.html">GCIMSDataset</a></span><span class="op">(</span></span>
<span>  <span class="va">annotations</span>,</span>
<span>  base_dir <span class="op">=</span> <span class="va">samples_directory</span>,</span>
<span>  on_ram <span class="op">=</span> <span class="cn">TRUE</span> <span class="co"># You probably should set this to FALSE if you have more </span></span>
<span>                <span class="co"># than a handful of samples. See ?GCIMSDataset.</span></span>
<span><span class="op">)</span></span>
<span><span class="va">dataset</span></span>
<span><span class="co">#&gt; A GCIMSDataset object:</span></span>
<span><span class="co">#&gt; - With 3 samples on RAM</span></span>
<span><span class="co">#&gt; - No phenotypes</span></span>
<span><span class="co">#&gt; - No previous history</span></span>
<span><span class="co">#&gt; - Pending operations:</span></span>
<span><span class="co">#&gt;   - read_sample</span></span></code></pre></div>
<p>Most operations on the <code>dataset</code> are not executed until
you need to get the actual samples or data. This is done to perform them
in batch, more efficiently, if possible. However, you can manually
<code>realize</code> the <code>GCIMSDataset</code> object so it executes
all its pending operations. We can see how the “read_sample” pending
operation becomes part of the dataset history:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/realize.html">realize</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">)</span></span>
<span><span class="va">dataset</span></span>
<span><span class="co">#&gt; A GCIMSDataset object:</span></span>
<span><span class="co">#&gt; - With 3 samples on RAM</span></span>
<span><span class="co">#&gt; - No phenotypes</span></span>
<span><span class="co">#&gt; - History:</span></span>
<span><span class="co">#&gt;   - read_sample</span></span>
<span><span class="co">#&gt; - No pending operations</span></span></code></pre></div>
<p>Explore one sample:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ket1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GCIMS-generics.html">getSample</a></span><span class="op">(</span><span class="va">dataset</span>, sample <span class="op">=</span> <span class="st">"Ketones1"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ket1</span>, rt_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1000</span><span class="op">)</span>, dt_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">7.5</span>, <span class="fl">17</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction-to-gcims_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dt_k1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GCIMS-generics.html">dtime</a></span><span class="op">(</span><span class="va">ket1</span><span class="op">)</span></span>
<span><span class="va">tis_k1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GCIMS-generics.html">getTIS</a></span><span class="op">(</span><span class="va">ket1</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">dt_k1</span>, y <span class="op">=</span> <span class="va">tis_k1</span><span class="op">)</span>, <span class="va">x</span> <span class="op">&gt;</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Drift time (ms)"</span>, limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">7</span>, <span class="fl">17</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Intensity (a.u)"</span>, trans <span class="op">=</span> <span class="fu"><a href="../reference/cubic_root_trans.html">cubic_root_trans</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed 2848 rows containing missing values (`geom_line()`).</span></span></code></pre></div>
<p><img src="introduction-to-gcims_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rt_k1</span> <span class="op">&lt;-</span> <span class="fu">rtime</span><span class="op">(</span><span class="va">ket1</span><span class="op">)</span></span>
<span><span class="va">ric_k1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GCIMS-generics.html">getRIC</a></span><span class="op">(</span><span class="va">ket1</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">rt_k1</span>, y <span class="op">=</span> <span class="va">ric_k1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Retention time (ms)"</span>, limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">55</span>, <span class="fl">900</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Intensity (a.u)"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed 2908 rows containing missing values (`geom_line()`).</span></span></code></pre></div>
<p><img src="introduction-to-gcims_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
<p>Plot the RIC and the TIS to get an overview of the dataset:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/GCIMS-generics.html">plotTIS</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction-to-gcims_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/GCIMS-generics.html">plotRIC</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction-to-gcims_files/figure-html/unnamed-chunk-12-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="filter-the-retention-and-drift-time-of-your-samples">Filter the retention and drift time of your samples<a class="anchor" aria-label="anchor" href="#filter-the-retention-and-drift-time-of-your-samples"></a>
</h2>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">filterRt</span><span class="op">(</span><span class="va">dataset</span>, rt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1300</span><span class="op">)</span><span class="op">)</span> <span class="co"># in s</span></span>
<span><span class="fu"><a href="../reference/GCIMS-generics.html">filterDt</a></span><span class="op">(</span><span class="va">dataset</span>, dt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">17</span><span class="op">)</span><span class="op">)</span> <span class="co"># in ms</span></span>
<span><span class="va">dataset</span></span>
<span><span class="co">#&gt; A GCIMSDataset object:</span></span>
<span><span class="co">#&gt; - With 3 samples on RAM</span></span>
<span><span class="co">#&gt; - No phenotypes</span></span>
<span><span class="co">#&gt; - History:</span></span>
<span><span class="co">#&gt;   - read_sample</span></span>
<span><span class="co">#&gt; - Pending operations:</span></span>
<span><span class="co">#&gt;   - filterRt:</span></span>
<span><span class="co">#&gt;       rt_range:</span></span>
<span><span class="co">#&gt;       - 0.0</span></span>
<span><span class="co">#&gt;       - 1300.0</span></span>
<span><span class="co">#&gt;   - filterDt:</span></span>
<span><span class="co">#&gt;       dt_range:</span></span>
<span><span class="co">#&gt;       - 1.0</span></span>
<span><span class="co">#&gt;       - 17.0</span></span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ket1afterfilter</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GCIMS-generics.html">getSample</a></span><span class="op">(</span><span class="va">dataset</span>, sample <span class="op">=</span> <span class="st">"Ketones1"</span><span class="op">)</span></span>
<span><span class="va">ket1afterfilter</span></span>
<span><span class="co">#&gt; A GCIMS Sample</span></span>
<span><span class="co">#&gt;  with drift time from 1 to 17 ms (step: 0.00667 ms, points: 2401)</span></span>
<span><span class="co">#&gt;  with retention time from 0 to 1299.87 s (step: 0.39 s, points: 3334)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="smoothing">Smoothing<a class="anchor" aria-label="anchor" href="#smoothing"></a>
</h2>
<p>You can remove noise from your sample using a Savitzky-Golay filter,
applied both in drift time and in retention time.</p>
<p>The Savitzky-Golay has two main parameters: the filter length and the
filter order. It is recommended to use a filter order of 2, but the
filter length must be selected so it is large enough to remove noise but
always smaller than the peak width to prevent distorting the peaks.</p>
<p>You can apply the smoothing filter to a single IMS spectrum or to a
single chromatogram to see how noise is removed and how peaks are not
distorted. Tweak the filter lengths and, once you are happy, apply the
smoothing filter to all the dataset.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">one_ims_spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GCIMS-generics.html">getSpectrum</a></span><span class="op">(</span><span class="va">ket1afterfilter</span>, rt_range <span class="op">=</span> <span class="fl">97.11</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">one_ims_smoothed</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/smooth.html" class="external-link">smooth</a></span><span class="op">(</span><span class="va">one_ims_spec</span>, dt_length_ms <span class="op">=</span> <span class="fl">0.14</span>, dt_order <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">to_plot</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span></span>
<span>  NoSmoothed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">one_ims_spec</span><span class="op">)</span>,</span>
<span>  Smoothed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">one_ims_smoothed</span><span class="op">)</span>,</span>
<span>  .id <span class="op">=</span> <span class="st">"Status"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">to_plot</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">drift_time_ms</span>, y <span class="op">=</span> <span class="va">intensity</span>, colour <span class="op">=</span> <span class="va">Status</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">7</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Drift time (ms)"</span>, y <span class="op">=</span> <span class="st">"Intensity (a.u.)"</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction-to-gcims_files/figure-html/unnamed-chunk-15-1.png" width="700"></p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">to_plot</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">drift_time_ms</span>, y <span class="op">=</span> <span class="va">intensity</span>, colour <span class="op">=</span> <span class="va">Status</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">7</span>, <span class="fl">10</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">300</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Drift time (ms)"</span>, y <span class="op">=</span> <span class="st">"Intensity (a.u.)"</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction-to-gcims_files/figure-html/unnamed-chunk-15-2.png" width="700"></p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">one_chrom</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GCIMS-generics.html">getChromatogram</a></span><span class="op">(</span><span class="va">ket1afterfilter</span>, dt_range <span class="op">=</span> <span class="fl">10.4</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">one_chrom_smoothed</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/smooth.html" class="external-link">smooth</a></span><span class="op">(</span><span class="va">one_chrom</span>, rt_length_s <span class="op">=</span> <span class="fl">3</span>, rt_order <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">to_plot</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span></span>
<span>  NoSmoothed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">one_chrom</span><span class="op">)</span>,</span>
<span>  Smoothed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">one_chrom_smoothed</span><span class="op">)</span>,</span>
<span>  .id <span class="op">=</span> <span class="st">"Status"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">to_plot</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">retention_time_s</span>, y <span class="op">=</span> <span class="va">intensity</span>, colour <span class="op">=</span> <span class="va">Status</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Retention time (s)"</span>, y <span class="op">=</span> <span class="st">"Intensity (a.u.)"</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction-to-gcims_files/figure-html/unnamed-chunk-17-1.png" width="700"></p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">to_plot</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">retention_time_s</span>, y <span class="op">=</span> <span class="va">intensity</span>, colour <span class="op">=</span> <span class="va">Status</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">200</span>, <span class="fl">250</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Retention time (s)"</span>, y <span class="op">=</span> <span class="st">"Intensity (a.u.)"</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction-to-gcims_files/figure-html/unnamed-chunk-17-2.png" width="700"></p>
<p>You can also apply it to a single sample:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ket1_smoothed</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/smooth.html" class="external-link">smooth</a></span><span class="op">(</span></span>
<span>  <span class="va">ket1afterfilter</span>,</span>
<span>  rt_length_s <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  dt_length_ms <span class="op">=</span> <span class="fl">0.14</span>,</span>
<span>  rt_order <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  dt_order <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html" class="external-link">plot_grid</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ket1afterfilter</span>, rt_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">500</span><span class="op">)</span>, dt_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">6</span>, <span class="fl">16</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ket1_smoothed</span>, rt_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">500</span><span class="op">)</span>, dt_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">6</span>, <span class="fl">16</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  ncol <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction-to-gcims_files/figure-html/unnamed-chunk-19-1.png" width="700"></p>
<p>Or to the whole dataset (the default order is 2 for both axes):</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dataset</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/smooth.html" class="external-link">smooth</a></span><span class="op">(</span><span class="va">dataset</span>, rt_length_s <span class="op">=</span> <span class="fl">3</span>, dt_length_ms <span class="op">=</span> <span class="fl">0.14</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/realize.html">realize</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="decimation">Decimation<a class="anchor" aria-label="anchor" href="#decimation"></a>
</h2>
<p>One way to speed up calculations and reduce the memory requirements
is to decimate the matrix, by taking 1 every Nd points in drift time and
1 every Nr points in retention time.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ket1_decimated</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GCIMS-generics.html">decimate</a></span><span class="op">(</span><span class="va">ket1_smoothed</span>, rt_factor <span class="op">=</span> <span class="fl">1</span>, dt_factor <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ket1_spec_smoothed</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GCIMS-generics.html">getSpectrum</a></span><span class="op">(</span><span class="va">ket1_smoothed</span>, rt_range <span class="op">=</span> <span class="fl">300</span>, dt_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">7</span>, <span class="fl">13</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ket1_spec_decimated</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GCIMS-generics.html">getSpectrum</a></span><span class="op">(</span><span class="va">ket1_decimated</span>, rt_range <span class="op">=</span> <span class="fl">300</span>, dt_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">7</span>, <span class="fl">13</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html" class="external-link">plot_grid</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ket1_spec_smoothed</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Before decimation"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ket1_spec_decimated</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"After decimation"</span><span class="op">)</span>,</span>
<span>  ncol <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction-to-gcims_files/figure-html/unnamed-chunk-23-1.png" width="700"></p>
<p>Once you are satisfied with de decimation factor (if you want to
apply it) just use it on the whole dataset:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dataset</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GCIMS-generics.html">decimate</a></span><span class="op">(</span><span class="va">dataset</span>, rt_factor <span class="op">=</span> <span class="fl">1</span>, dt_factor <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p>One alternative is to start with a higher decimation factor (lets say
2 in retention time and 4 in drift time) and, after running the pipeline
successfully, repeat it without decimation.</p>
</div>
<div class="section level2">
<h2 id="alignment">Alignment<a class="anchor" aria-label="anchor" href="#alignment"></a>
</h2>
<p>Pressure and temperature fluctuations as well as degradation of the
chromatographic column are some of the causes of misalignments in the
data, both in retention and drift time.</p>
<p>In order to be able to compare samples to each other, we align the
samples.</p>
<p>The alignment will happen first in drift time and afterwards in
retention time. To correct the drift time, we will use a multiplicative
correction <span class="math inline">\(t_d' = k t_d\)</span>. The
correction factor <span class="math inline">\(k\)</span> will be
estimated using the RIP positions for each sample, extracted from the
Total Ion Spectra. The correction factors are typically between 0.9 and
1.1. The reference RIP position is the median of all the RIP positions
to minimize the distortions.</p>
<p>One of the checks to verify the alignment in drift time is not
failing is by plotting the Total Ion Spectra of several samples before
and after the alignment and see the effect of the correction.</p>
<p>The retention time will be corrected using Parametric Time Warping,
where <span class="math inline">\(t_r' = P(t_r)\)</span>, and <span class="math inline">\(P\)</span> is a polynomial of typically not a high
order (1-5). For efficiency reasons, the polynomial will be estimated
using the Reverse Ion Chromatogram of the samples to be aligned.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/GCIMS-generics.html">plotTIS</a></span><span class="op">(</span><span class="va">dataset</span>, dt_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">7</span>, <span class="fl">17</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction-to-gcims_files/figure-html/unnamed-chunk-25-1.png" width="700"></p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/GCIMS-generics.html">plotRIC</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction-to-gcims_files/figure-html/unnamed-chunk-26-1.png" width="700"></p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/GCIMS-generics.html">align</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/realize.html">realize</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/GCIMS-generics.html">plotTIS</a></span><span class="op">(</span><span class="va">dataset</span>, dt_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">7</span>, <span class="fl">17</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction-to-gcims_files/figure-html/unnamed-chunk-28-1.png" width="700"></p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/GCIMS-generics.html">plotRIC</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction-to-gcims_files/figure-html/unnamed-chunk-29-1.png" width="700"></p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">align_plots</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/alignPlots.html">alignPlots</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">)</span></span>
<span><span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html" class="external-link">plot_grid</a></span><span class="op">(</span>plotlist <span class="op">=</span> <span class="va">align_plots</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction-to-gcims_files/figure-html/unnamed-chunk-30-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="peaks">Peaks<a class="anchor" aria-label="anchor" href="#peaks"></a>
</h2>
<p>First try one sample and optimize the <code>noise_level</code>
parameter there. Change values from 0.5 to 4 to explore. If it’s higher
less peaks will be found. If it is too low peaks may appear broken into
two regions or false detections may occur.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Remove this extra register()</span></span>
<span><span class="va">ket1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GCIMS-generics.html">getSample</a></span><span class="op">(</span><span class="va">dataset</span>, <span class="st">"Ketones1"</span><span class="op">)</span></span>
<span><span class="va">ch1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GCIMS-generics.html">getChromatogram</a></span><span class="op">(</span><span class="va">ket1</span>, dt_range <span class="op">=</span> <span class="fl">10.75</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># I don't like the _xunits in the argument names, I'll find an alternative soon</span></span>
<span><span class="va">ch1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/findPeaks.html">findPeaks</a></span><span class="op">(</span></span>
<span>  <span class="va">ch1</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  length_in_xunits <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  peakwidth_range_xunits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">25</span><span class="op">)</span>,</span>
<span>  peakDetectionCWTParams <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>exclude0scaleAmpThresh <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  extension_factor <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  iou_overlap_threshold <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>  debug <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="va">peak_list_ch1</span> <span class="op">&lt;-</span> <span class="fu">peaks</span><span class="op">(</span><span class="va">ch1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ch1</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">peak_list_ch1</span><span class="op">$</span><span class="va">apex</span>, color <span class="op">=</span> <span class="st">"red"</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction-to-gcims_files/figure-html/unnamed-chunk-31-1.png" width="700"></p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ket1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/findPeaks.html">findPeaks</a></span><span class="op">(</span></span>
<span>  <span class="va">ket1</span>,</span>
<span>  rt_length_s <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  dt_length_ms <span class="op">=</span> <span class="fl">0.14</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  dt_peakwidth_range_ms <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.15</span>, <span class="fl">0.4</span><span class="op">)</span>,</span>
<span>  rt_peakwidth_range_s <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">25</span><span class="op">)</span>,</span>
<span>  dt_peakDetectionCWTParams <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>exclude0scaleAmpThresh <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  rt_peakDetectionCWTParams <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>exclude0scaleAmpThresh <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  dt_extension_factor <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  rt_extension_factor <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  exclude_rip <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  iou_overlap_threshold <span class="op">=</span> <span class="fl">0.2</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Using the following scales</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">ℹ</span> Retention time scales: 1, 26, 39, 59, 64</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">ℹ</span> Drift time scales: 1, 11, 17, 25, 30</span></span></code></pre></div>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">peak_list_ket1</span> <span class="op">&lt;-</span> <span class="fu">peaks</span><span class="op">(</span><span class="va">ket1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ket1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/overlay_peaklist.html">overlay_peaklist</a></span><span class="op">(</span><span class="va">peak_list_ket1</span>, color_by <span class="op">=</span> <span class="st">"PeakID"</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction-to-gcims_files/figure-html/unnamed-chunk-33-1.png" width="700"></p>
<p>Then do it on the whole dataset:</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/findPeaks.html">findPeaks</a></span><span class="op">(</span></span>
<span>  <span class="va">dataset</span>,</span>
<span>  rt_length_s <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  dt_length_ms <span class="op">=</span> <span class="fl">0.14</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  dt_peakwidth_range_ms <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.15</span>, <span class="fl">0.4</span><span class="op">)</span>,</span>
<span>  rt_peakwidth_range_s <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">25</span><span class="op">)</span>,</span>
<span>  dt_peakDetectionCWTParams <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>exclude0scaleAmpThresh <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  rt_peakDetectionCWTParams <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>exclude0scaleAmpThresh <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  dt_extension_factor <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  rt_extension_factor <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  exclude_rip <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  iou_overlap_threshold <span class="op">=</span> <span class="fl">0.2</span></span>
<span><span class="op">)</span></span>
<span><span class="va">peak_list</span> <span class="op">&lt;-</span> <span class="fu">peaks</span><span class="op">(</span><span class="va">dataset</span><span class="op">)</span></span>
<span><span class="co">#&gt; Using the following scales</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">ℹ</span> Retention time scales: 1, 26, 39, 59, 64</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">ℹ</span> Drift time scales: 1, 11, 17, 25, 30</span></span>
<span><span class="co">#&gt; RIP was detected</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">ℹ</span>  - At drift time: [7.50666666666667 - 7.90666666666667] ms</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">ℹ</span>  - Maximum RIP intensity at: (dt: 7.78666666666667 ms, rt: 50.31 s)</span></span>
<span><span class="co">#&gt; Using the following scales</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">ℹ</span> Retention time scales: 1, 26, 39, 59, 64</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">ℹ</span> Drift time scales: 1, 11, 17, 25, 30</span></span>
<span><span class="co">#&gt; RIP was detected</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">ℹ</span>  - At drift time: [7.54666666666667 - 7.90666666666667] ms</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">ℹ</span>  - Maximum RIP intensity at: (dt: 7.78666666666667 ms, rt: 56.55 s)</span></span>
<span><span class="co">#&gt; Using the following scales</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">ℹ</span> Retention time scales: 1, 26, 39, 59, 64</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">ℹ</span> Drift time scales: 1, 11, 17, 25, 30</span></span>
<span><span class="co">#&gt; RIP was detected</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">ℹ</span>  - At drift time: [7.50666666666667 - 7.90666666666667] ms</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">ℹ</span>  - Maximum RIP intensity at: (dt: 7.78666666666667 ms, rt: 51.48 s)</span></span></code></pre></div>
<p>You can get any other sample if you like, plot it and plot its peaks
on top:</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ket2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GCIMS-generics.html">getSample</a></span><span class="op">(</span><span class="va">dataset</span>, <span class="st">"Ketones2"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ket2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/overlay_peaklist.html">overlay_peaklist</a></span><span class="op">(</span><span class="fu">peaks</span><span class="op">(</span><span class="va">ket2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">lims</a></span><span class="op">(</span>x<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">7.5</span>,<span class="fl">15</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">500</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Scale for <span style="color: #00BB00;">x</span> is already present.</span></span>
<span><span class="co">#&gt; Adding another scale for <span style="color: #00BB00;">x</span>, which will replace the existing scale.</span></span>
<span><span class="co">#&gt; Scale for <span style="color: #00BB00;">y</span> is already present.</span></span>
<span><span class="co">#&gt; Adding another scale for <span style="color: #00BB00;">y</span>, which will replace the existing scale.</span></span>
<span><span class="co">#&gt; Warning: Removed 15 rows containing missing values (`geom_rect()`).</span></span>
<span><span class="co">#&gt; Warning: Removed 15 rows containing missing values (`geom_point()`).</span></span></code></pre></div>
<p><img src="introduction-to-gcims_files/figure-html/unnamed-chunk-36-1.png" width="700"></p>
<p>Or plot all the peaks from all the dataset together, overlayed on a
single sample:</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ket2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/overlay_peaklist.html">overlay_peaklist</a></span><span class="op">(</span><span class="fu">peaks</span><span class="op">(</span><span class="va">dataset</span><span class="op">)</span>, color_by <span class="op">=</span> <span class="st">"SampleID"</span><span class="op">)</span></span>
<span><span class="co"># We could explore the plot interactively: </span></span>
<span><span class="co"># plot_interactive(plt)</span></span>
<span><span class="co"># Or use a static version to save memory and render it faster:</span></span>
<span><span class="va">plt</span></span></code></pre></div>
<p><img src="introduction-to-gcims_files/figure-html/unnamed-chunk-37-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="clustering">Clustering<a class="anchor" aria-label="anchor" href="#clustering"></a>
</h2>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">peak_clustering</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/clusterPeaks.html">clusterPeaks</a></span><span class="op">(</span></span>
<span>  <span class="va">peak_list</span>,</span>
<span>  distance_method <span class="op">=</span> <span class="st">"euclidean"</span>,</span>
<span>  dt_cluster_spread_ms <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>  rt_cluster_spread_s <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  clustering <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"hclust"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The peak list, with cluster ids can be plotted on top of a single
sample:</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">peak_list_clustered</span> <span class="op">&lt;-</span> <span class="va">peak_clustering</span><span class="op">$</span><span class="va">peak_list_clustered</span></span></code></pre></div>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ket2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/overlay_peaklist.html">overlay_peaklist</a></span><span class="op">(</span><span class="va">peak_list_clustered</span>, color_by <span class="op">=</span> <span class="st">"SampleID"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">plt</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction-to-gcims_files/figure-html/unnamed-chunk-39-1.png" width="960"></p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">plt</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">lims</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">6</span>, <span class="fl">15</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">400</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Scale for <span style="color: #00BB00;">x</span> is already present.</span></span>
<span><span class="co">#&gt; Adding another scale for <span style="color: #00BB00;">x</span>, which will replace the existing scale.</span></span>
<span><span class="co">#&gt; Scale for <span style="color: #00BB00;">y</span> is already present.</span></span>
<span><span class="co">#&gt; Adding another scale for <span style="color: #00BB00;">y</span>, which will replace the existing scale.</span></span>
<span><span class="co">#&gt; Warning: Removed 39 rows containing missing values (`geom_rect()`).</span></span>
<span><span class="co">#&gt; Warning: Removed 39 rows containing missing values (`geom_point()`).</span></span></code></pre></div>
<p><img src="introduction-to-gcims_files/figure-html/unnamed-chunk-39-2.png" width="960"></p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ket2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/overlay_peaklist.html">overlay_peaklist</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">peak_list_clustered</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">cluster</span><span class="op">)</span><span class="op">)</span>, color_by <span class="op">=</span> <span class="st">"cluster"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">plt</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction-to-gcims_files/figure-html/unnamed-chunk-40-1.png" width="700"></p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">plt</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">lims</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">6</span>, <span class="fl">15</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">400</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Scale for <span style="color: #00BB00;">x</span> is already present.</span></span>
<span><span class="co">#&gt; Adding another scale for <span style="color: #00BB00;">x</span>, which will replace the existing scale.</span></span>
<span><span class="co">#&gt; Scale for <span style="color: #00BB00;">y</span> is already present.</span></span>
<span><span class="co">#&gt; Adding another scale for <span style="color: #00BB00;">y</span>, which will replace the existing scale.</span></span>
<span><span class="co">#&gt; Warning: Removed 26 rows containing missing values (`geom_rect()`).</span></span>
<span><span class="co">#&gt; Warning: Removed 26 rows containing missing values (`geom_point()`).</span></span></code></pre></div>
<p><img src="introduction-to-gcims_files/figure-html/unnamed-chunk-40-2.png" width="700"></p>
<p>The resulting cluster sizes (median position of individual clusters)
is not a good reference for integration. We are working on this.</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ket2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/overlay_peaklist.html">overlay_peaklist</a></span><span class="op">(</span><span class="va">peak_clustering</span><span class="op">$</span><span class="va">cluster_stats</span>, color_by <span class="op">=</span> <span class="st">"cluster"</span><span class="op">)</span></span>
<span><span class="co">#plot_interactive(plt)</span></span>
<span><span class="va">plt</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">lims</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">6</span>, <span class="fl">15</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">400</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Scale for <span style="color: #00BB00;">x</span> is already present.</span></span>
<span><span class="co">#&gt; Adding another scale for <span style="color: #00BB00;">x</span>, which will replace the existing scale.</span></span>
<span><span class="co">#&gt; Scale for <span style="color: #00BB00;">y</span> is already present.</span></span>
<span><span class="co">#&gt; Adding another scale for <span style="color: #00BB00;">y</span>, which will replace the existing scale.</span></span>
<span><span class="co">#&gt; Warning: Removed 9 rows containing missing values (`geom_rect()`).</span></span>
<span><span class="co">#&gt; Warning: Removed 9 rows containing missing values (`geom_point()`).</span></span></code></pre></div>
<p><img src="introduction-to-gcims_files/figure-html/unnamed-chunk-41-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="baseline-correction">Baseline correction<a class="anchor" aria-label="anchor" href="#baseline-correction"></a>
</h2>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ket1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GCIMS-generics.html">getSample</a></span><span class="op">(</span><span class="va">dataset</span>, <span class="st">"Ketones1"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">one_ims_spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GCIMS-generics.html">getSpectrum</a></span><span class="op">(</span><span class="va">ket1</span>, rt_range <span class="op">=</span> <span class="fl">97.11</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">one_ims_spec</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">7</span>, <span class="fl">12</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction-to-gcims_files/figure-html/unnamed-chunk-43-1.png" width="700"></p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">one_ims_spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GCIMS-generics.html">estimateBaseline</a></span><span class="op">(</span><span class="va">one_ims_spec</span>, dt_peak_fwhm_ms <span class="op">=</span> <span class="fl">0.2</span>, dt_region_multiplier <span class="op">=</span> <span class="fl">12</span><span class="op">)</span></span>
<span><span class="va">to_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  drift_time_ms <span class="op">=</span> <span class="fu"><a href="../reference/GCIMS-generics.html">dtime</a></span><span class="op">(</span><span class="va">one_ims_spec</span><span class="op">)</span>,</span>
<span>  Intensity <span class="op">=</span> <span class="fu">intensity</span><span class="op">(</span><span class="va">one_ims_spec</span><span class="op">)</span>,</span>
<span>  Baseline <span class="op">=</span> <span class="fu"><a href="../reference/GCIMS-generics.html">baseline</a></span><span class="op">(</span><span class="va">one_ims_spec</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">to_plot</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">drift_time_ms</span>, y <span class="op">=</span> <span class="va">Intensity</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">drift_time_ms</span>, y <span class="op">=</span> <span class="va">Baseline</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Drift time (ms)"</span>, y <span class="op">=</span> <span class="st">"Intensity (a.u.)"</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction-to-gcims_files/figure-html/unnamed-chunk-44-1.png" width="700"></p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">to_plot</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">drift_time_ms</span>, y <span class="op">=</span> <span class="va">Intensity</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">drift_time_ms</span>, y <span class="op">=</span> <span class="va">Baseline</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">7</span>, <span class="fl">10</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">500</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Drift time (ms)"</span>, y <span class="op">=</span> <span class="st">"Intensity (a.u.)"</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction-to-gcims_files/figure-html/unnamed-chunk-44-2.png" width="700"></p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">one_chrom</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GCIMS-generics.html">getChromatogram</a></span><span class="op">(</span><span class="va">ket1</span>, dt_range <span class="op">=</span> <span class="fl">10.4</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">one_chrom</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GCIMS-generics.html">estimateBaseline</a></span><span class="op">(</span><span class="va">one_chrom</span>, rt_length_s <span class="op">=</span> <span class="fl">200</span><span class="op">)</span></span>
<span><span class="va">to_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  retention_time_s <span class="op">=</span> <span class="fu">rtime</span><span class="op">(</span><span class="va">one_chrom</span><span class="op">)</span>,</span>
<span>  Intensity <span class="op">=</span> <span class="fu">intensity</span><span class="op">(</span><span class="va">one_chrom</span><span class="op">)</span>,</span>
<span>  Baseline <span class="op">=</span> <span class="fu"><a href="../reference/GCIMS-generics.html">baseline</a></span><span class="op">(</span><span class="va">one_chrom</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">to_plot</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">retention_time_s</span>, y <span class="op">=</span> <span class="va">Intensity</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">retention_time_s</span>, y <span class="op">=</span> <span class="va">Baseline</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Retention time (s)"</span>, y <span class="op">=</span> <span class="st">"Intensity (a.u.)"</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction-to-gcims_files/figure-html/unnamed-chunk-46-1.png" width="700"></p>
<p>You can also apply it to a single sample:</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ket1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GCIMS-generics.html">estimateBaseline</a></span><span class="op">(</span></span>
<span>  <span class="va">ket1</span>,</span>
<span>  dt_peak_fwhm_ms <span class="op">=</span> <span class="fl">0.2</span>, </span>
<span>  dt_region_multiplier <span class="op">=</span> <span class="fl">12</span>,</span>
<span>  rt_length_s <span class="op">=</span> <span class="fl">200</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ket1</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction-to-gcims_files/figure-html/unnamed-chunk-48-1.png" width="700"></p>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ket1</span>, remove_baseline <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction-to-gcims_files/figure-html/unnamed-chunk-49-1.png" width="700"></p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html" class="external-link">plot_grid</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ket1</span>, rt_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">500</span><span class="op">)</span>, dt_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">6</span>, <span class="fl">16</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ket1</span>, rt_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">500</span><span class="op">)</span>, dt_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">6</span>, <span class="fl">16</span><span class="op">)</span>, remove_baseline <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  ncol <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction-to-gcims_files/figure-html/unnamed-chunk-50-1.png" width="700"></p>
<p>Or to the whole dataset:</p>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dataset</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GCIMS-generics.html">estimateBaseline</a></span><span class="op">(</span></span>
<span>  <span class="va">dataset</span>,</span>
<span>  dt_peak_fwhm_ms <span class="op">=</span> <span class="fl">0.2</span>, </span>
<span>  dt_region_multiplier <span class="op">=</span> <span class="fl">12</span>,</span>
<span>  rt_length_s <span class="op">=</span> <span class="fl">200</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/realize.html">realize</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">)</span></span></code></pre></div>
<p>Some clusters:</p>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ket2</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="../reference/overlay_peaklist.html">overlay_peaklist</a></span><span class="op">(</span></span>
<span>    <span class="va">peak_clustering</span><span class="op">$</span><span class="va">peak_list_clustered</span>,</span>
<span>    color_by <span class="op">=</span> <span class="st">"SampleID"</span>,</span>
<span>    mapping_roi <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="st">"dt_min_ms"</span> <span class="op">=</span> <span class="st">"fixedsize_dt_min_ms"</span>,</span>
<span>      <span class="st">"dt_max_ms"</span> <span class="op">=</span> <span class="st">"fixedsize_dt_max_ms"</span>,</span>
<span>      <span class="st">"rt_min_s"</span> <span class="op">=</span> <span class="st">"fixedsize_rt_min_s"</span>,</span>
<span>      <span class="st">"rt_max_s"</span> <span class="op">=</span> <span class="st">"fixedsize_rt_max_s"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">lims</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">6</span>, <span class="fl">12</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">400</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Scale for <span style="color: #00BB00;">x</span> is already present.</span></span>
<span><span class="co">#&gt; Adding another scale for <span style="color: #00BB00;">x</span>, which will replace the existing scale.</span></span>
<span><span class="co">#&gt; Scale for <span style="color: #00BB00;">y</span> is already present.</span></span>
<span><span class="co">#&gt; Adding another scale for <span style="color: #00BB00;">y</span>, which will replace the existing scale.</span></span>
<span><span class="co">#&gt; Warning: Removed 34 rows containing missing values (`geom_rect()`).</span></span>
<span><span class="co">#&gt; Warning: Removed 47 rows containing missing values (`geom_point()`).</span></span></code></pre></div>
<p><img src="introduction-to-gcims_files/figure-html/unnamed-chunk-52-1.png" width="960"></p>
</div>
<div class="section level2">
<h2 id="peak-integration">Peak integration<a class="anchor" aria-label="anchor" href="#peak-integration"></a>
</h2>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dataset</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GCIMS-generics.html">integratePeaks</a></span><span class="op">(</span></span>
<span>  <span class="va">dataset</span>, </span>
<span>  <span class="va">peak_clustering</span><span class="op">$</span><span class="va">peak_list</span>, </span>
<span>  integration_size_method <span class="op">=</span> <span class="st">"fixed_size"</span>, </span>
<span>  rip_saturation_threshold <span class="op">=</span> <span class="fl">0.1</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">peak_list</span> <span class="op">&lt;-</span> <span class="fu">peaks</span><span class="op">(</span><span class="va">dataset</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="build-peak-table">Build peak table<a class="anchor" aria-label="anchor" href="#build-peak-table"></a>
</h2>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">peak_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/peakTable.html">peakTable</a></span><span class="op">(</span><span class="va">peak_list</span>, aggregate_conflicting_peaks <span class="op">=</span> <span class="va">max</span><span class="op">)</span></span>
<span><span class="va">peak_table</span><span class="op">$</span><span class="va">peak_table_matrix</span></span>
<span><span class="co">#&gt;          Cluster08 NA Cluster14 Cluster10 Cluster06 Cluster03 Cluster17</span></span>
<span><span class="co">#&gt; Ketones1  286.1551 NA  89.94959  79.89563  50.03299  535.8669  101.4803</span></span>
<span><span class="co">#&gt; Ketones2  317.4772 NA 121.71349  91.67827  57.87489  500.3966  177.5513</span></span>
<span><span class="co">#&gt; Ketones3  345.9414 NA 107.86073  90.36581  50.78306  551.7133        NA</span></span>
<span><span class="co">#&gt;          Cluster11 Cluster09 Cluster12 Cluster04 Cluster21 Cluster15 Cluster24</span></span>
<span><span class="co">#&gt; Ketones1  80.29613  1399.228  43.86774  28.82509  2281.579  627.5607  245.6123</span></span>
<span><span class="co">#&gt; Ketones2 112.30167  1164.095  51.60048  31.27176  2018.413  983.4542  294.6938</span></span>
<span><span class="co">#&gt; Ketones3  88.13129  1446.306  59.13701  38.09293  2435.891  841.2746  258.3220</span></span>
<span><span class="co">#&gt;          Cluster07 Cluster23 Cluster13 Cluster22 Cluster05 Cluster20 Cluster02</span></span>
<span><span class="co">#&gt; Ketones1  485.1055  1335.125  1400.486  1387.270  4424.315  8794.791  87.56821</span></span>
<span><span class="co">#&gt; Ketones2  428.6557  1095.035  2317.797  1534.135  4842.550  9263.876  71.72692</span></span>
<span><span class="co">#&gt; Ketones3  418.2265  1461.980  2237.396  1977.921  4786.573  9342.802        NA</span></span>
<span><span class="co">#&gt;          Cluster19 Cluster18 Cluster16 Cluster01</span></span>
<span><span class="co">#&gt; Ketones1  432.0507  12837.13        NA        NA</span></span>
<span><span class="co">#&gt; Ketones2  590.4338  13707.02  30.26957  47.80361</span></span>
<span><span class="co">#&gt; Ketones3  353.5802  13684.53  35.84527  47.91265</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="imputation">Imputation<a class="anchor" aria-label="anchor" href="#imputation"></a>
</h2>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">peak_table_imputed</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/imputePeakTable.html">imputePeakTable</a></span><span class="op">(</span><span class="va">peak_table</span><span class="op">$</span><span class="va">peak_table_matrix</span>, <span class="va">dataset</span>, <span class="va">peak_clustering</span><span class="op">$</span><span class="va">cluster_stats</span><span class="op">)</span></span>
<span><span class="va">peak_table_imputed</span></span>
<span><span class="co">#&gt;          Cluster08 NA Cluster14 Cluster10 Cluster06 Cluster03 Cluster17</span></span>
<span><span class="co">#&gt; Ketones1  286.1551  0  89.94959  79.89563  50.03299  535.8669  101.4803</span></span>
<span><span class="co">#&gt; Ketones2  317.4772  0 121.71349  91.67827  57.87489  500.3966  177.5513</span></span>
<span><span class="co">#&gt; Ketones3  345.9414  0 107.86073  90.36581  50.78306  551.7133  113.2813</span></span>
<span><span class="co">#&gt;          Cluster11 Cluster09 Cluster12 Cluster04 Cluster21 Cluster15 Cluster24</span></span>
<span><span class="co">#&gt; Ketones1  80.29613  1399.228  43.86774  28.82509  2281.579  627.5607  245.6123</span></span>
<span><span class="co">#&gt; Ketones2 112.30167  1164.095  51.60048  31.27176  2018.413  983.4542  294.6938</span></span>
<span><span class="co">#&gt; Ketones3  88.13129  1446.306  59.13701  38.09293  2435.891  841.2746  258.3220</span></span>
<span><span class="co">#&gt;          Cluster07 Cluster23 Cluster13 Cluster22 Cluster05 Cluster20 Cluster02</span></span>
<span><span class="co">#&gt; Ketones1  485.1055  1335.125  1400.486  1387.270  4424.315  8794.791  87.56821</span></span>
<span><span class="co">#&gt; Ketones2  428.6557  1095.035  2317.797  1534.135  4842.550  9263.876  71.72692</span></span>
<span><span class="co">#&gt; Ketones3  418.2265  1461.980  2237.396  1977.921  4786.573  9342.802  65.21405</span></span>
<span><span class="co">#&gt;          Cluster19 Cluster18 Cluster16 Cluster01</span></span>
<span><span class="co">#&gt; Ketones1  432.0507  12837.13  30.13690  39.37941</span></span>
<span><span class="co">#&gt; Ketones2  590.4338  13707.02  30.26957  47.80361</span></span>
<span><span class="co">#&gt; Ketones3  353.5802  13684.53  35.84527  47.91265</span></span></code></pre></div>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Implemented until here</span></span>
<span><span class="va">end_time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"The vignette ran in  "</span>, <span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="va">end_time</span> <span class="op">-</span> <span class="va">start_time</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; The vignette ran in  4.367867 mins</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="session-info">Session Info:<a class="anchor" aria-label="anchor" href="#session-info"></a>
</h2>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; R version 4.2.2 (2022-10-31)</span></span>
<span><span class="co">#&gt; Platform: x86_64-pc-linux-gnu (64-bit)</span></span>
<span><span class="co">#&gt; Running under: Ubuntu 22.04.1 LTS</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Matrix products: default</span></span>
<span><span class="co">#&gt; BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3</span></span>
<span><span class="co">#&gt; LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.20.so</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; locale:</span></span>
<span><span class="co">#&gt;  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              </span></span>
<span><span class="co">#&gt;  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    </span></span>
<span><span class="co">#&gt;  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8   </span></span>
<span><span class="co">#&gt;  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 </span></span>
<span><span class="co">#&gt;  [9] LC_ADDRESS=C               LC_TELEPHONE=C            </span></span>
<span><span class="co">#&gt; [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attached base packages:</span></span>
<span><span class="co">#&gt; [1] stats     graphics  grDevices utils     datasets  methods   base     </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; other attached packages:</span></span>
<span><span class="co">#&gt; [1] GCIMS_0.1.0         ggplot2_3.4.1       BiocParallel_1.32.5</span></span>
<span><span class="co">#&gt; [4] BiocStyle_2.26.0   </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; loaded via a namespace (and not attached):</span></span>
<span><span class="co">#&gt;  [1] Rcpp_1.0.10            RcppDE_0.1.7           tidyr_1.3.0           </span></span>
<span><span class="co">#&gt;  [4] snow_0.4-4             rprojroot_2.0.3        digest_0.6.31         </span></span>
<span><span class="co">#&gt;  [7] utf8_1.2.3             plyr_1.8.8             R6_2.5.1              </span></span>
<span><span class="co">#&gt; [10] signal_0.7-7           stats4_4.2.2           sgolay_1.0.2          </span></span>
<span><span class="co">#&gt; [13] evaluate_0.20          httr_1.4.4             highr_0.10            </span></span>
<span><span class="co">#&gt; [16] pillar_1.8.1           rlang_1.0.6            curl_5.0.0            </span></span>
<span><span class="co">#&gt; [19] jquerylib_0.1.4        S4Vectors_0.36.1       rmarkdown_2.20        </span></span>
<span><span class="co">#&gt; [22] pkgdown_2.0.7          textshaping_0.3.6      desc_1.4.2            </span></span>
<span><span class="co">#&gt; [25] labeling_0.4.2         stringr_1.5.0          ProtGenerics_1.30.0   </span></span>
<span><span class="co">#&gt; [28] munsell_0.5.0          compiler_4.2.2         xfun_0.37             </span></span>
<span><span class="co">#&gt; [31] pkgconfig_2.0.3        systemfonts_1.0.4      BiocGenerics_0.44.0   </span></span>
<span><span class="co">#&gt; [34] htmltools_0.5.4        tidyselect_1.2.0       tibble_3.1.8          </span></span>
<span><span class="co">#&gt; [37] bookdown_0.32          codetools_0.2-19       fansi_1.0.4           </span></span>
<span><span class="co">#&gt; [40] viridisLite_0.4.1      dplyr_1.1.0            withr_2.5.0           </span></span>
<span><span class="co">#&gt; [43] MASS_7.3-58.2          MassSpecWavelet_1.65.0 grid_4.2.2            </span></span>
<span><span class="co">#&gt; [46] jsonlite_1.8.4         gtable_0.3.1           lifecycle_1.0.3       </span></span>
<span><span class="co">#&gt; [49] magrittr_2.0.3         scales_1.2.1           cli_3.6.0             </span></span>
<span><span class="co">#&gt; [52] stringi_1.7.12         cachem_1.0.6           reshape2_1.4.4        </span></span>
<span><span class="co">#&gt; [55] farver_2.1.1           ptw_1.9-16             fs_1.6.1              </span></span>
<span><span class="co">#&gt; [58] bslib_0.4.2            ragg_1.2.5             generics_0.1.3        </span></span>
<span><span class="co">#&gt; [61] vctrs_0.5.2            cowplot_1.1.1          tools_4.2.2           </span></span>
<span><span class="co">#&gt; [64] Biobase_2.58.0         glue_1.6.2             purrr_1.0.1           </span></span>
<span><span class="co">#&gt; [67] parallel_4.2.2         fastmap_1.1.0          yaml_2.3.7            </span></span>
<span><span class="co">#&gt; [70] colorspace_2.1-0       BiocManager_1.30.19    mdendro_2.1.0         </span></span>
<span><span class="co">#&gt; [73] memoise_2.0.1          knitr_1.42             sass_0.4.5</span></span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Celia Mallafré Muro, Luis Fernandez, Sergio Oller Moreno, Arnau Blanco Borrego, Santiago Marco Colás.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
